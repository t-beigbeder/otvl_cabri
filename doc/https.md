# Information for configuring and using a secured HTTP server

## Simple client-server HTTPS configuration

This is a simple HTTPS implementation with Basic Authentication,
but a dedicated proxy in front of the Cabri server, like [traefik](https://traefik.io/traefik/),
apache or nginx, will generally be required or more effective.

Generate certificates for the client and the server, for instance self-signed for localhost:

    $ openssl req -newkey rsa:2048 \
        -new -nodes -x509 \
        -days 3650 \
        -out cert.pem \
        -keyout key.pem \
        -subj "/C=FR/ST=Haute Garonne/CN=localhost" -addext "subjectAltName = DNS:localhost"

The credentials for Basic Authentication are global to clients or to servers
sharing the same configuration directory, and they currently need to be provided as identities
with the alias `WebBasicAuth`.

On the server host generate keys for basic authentication, then list them:

    $ cabri cli config --gen WebBasicAuth
    $ cabri cli config --get WebBasicAuth
        PKey: age1<user>
        Secret: AGE-SECRET-KEY-<userPassword>

On the client side import this identity:
    
    $ cabri cli config --put WebBasicAuth age1<user> AGE-SECRET-KEY-<userPassword>

When no WebBasicAuth identity exists in the configuration of the client or the server:

- the server does not check clients credentials
- the client does not authenticate itself, leading to an _unauthorized_ error
  if the server is performing authentication

You can then launch a secured HTTP server using the https protocol,
and providing a certificate and its key, for instance:

    $ cabri webapi olf+https://localhost:3443/home/guest/olf_server@demo \
        --tlscrt cert.pem --tlskey key.pem

You can finally access the server remotely with the https protocol as well,
keeping other parameters as usual.
When a self-signed certificate is used,
the client must provide it as following, for instance:

    $ cabri cli lsns webapi+https://localhost:3443/demo@ --tlscrt cert.pem

Accepting any certificate from the server without any check is not recommended
although possible using the `--tlsnc` flag.

## HTTPS authentication

When the HTTPS implementation is provided directly by the Cabri server as mentioned above,
the client must use the credentials generated by the server to authenticate itself,
so relying on keys stored in the Cabri local configuration file as explained before is convenient.

But when the Cabri server is accessed behind a proxy server such as [traefik](https://traefik.io/traefik/),
apache or nginx, the client must explicitly use the credentials authorized on the proxy server,
using the options below:

    --hpassword           force http client user password prompt
    --hpfile string       file containing the http client user password
    --huser string        http client user
